Har denne kode nu men de fejler stadig.  Kan den v√¶re for lang eller er detnogetandet?

<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Reaktionsspil ‚Äì Frugt & Gr√∏nt</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0; padding:0;">

<div id="rg-root" style="font-family:Arial, sans-serif; max-width:680px; margin:0 auto; text-align:center; padding:16px; background:#f7f7fb; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06)">
  <h2 style="margin:0 0 8px">Reaktionsspil: Frugt & Gr√∏nt üçéü•ï</h2>
  <div id="rg-ui" style="display:flex; gap:10px; align-items:center; justify-content:center; margin:6px 0 14px">
    <div id="rg-lives" style="font-weight:bold;">‚ù§Ô∏è‚ù§Ô∏è</div>
    <div style="flex:1; height:10px; background:#e5e7eb; border-radius:6px; overflow:hidden;">
      <div id="rg-timebar" style="height:100%; width:100%; background:#10b981; transition:width .08s linear;"></div>
    </div>
    <button id="rg-skip" style="padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer"
      onclick="window.rgNoMatch && rgNoMatch()">Billedet er der ikke</button>
  </div>

  <div id="rg-task" style="font-size:20px; margin:8px 0 14px; font-weight:600;">Klik ‚ÄòStart‚Äô for at spille</div>

  <div id="rg-board" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; justify-items:center; align-items:center; min-height:240px;"></div>

  <div id="rg-cta" style="margin-top:16px;">
    <button id="rg-start" style="padding:10px 16px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer"
      onclick="window.rgStart && rgStart()">Start</button>
  </div>

  <!-- Bootstrapping uden <script> -->
  <img alt="" style="display:none"
    onload="
(function(){
  // ------- STATE -------
  var state = {
    lives: 2, maxLives: 3,
    score: 0, round: 0,
    timeMs: 3000, minTime: 1200, stepTime: 120, // falder gradvist
    movingChance: 0.35, // chance for at et billede bev√¶ger sig
    bonusChance: 0.22,  // chance for bonusliv i en runde
    noMatchChance: 0.18, // chance for 'billedet er der ikke'
    specialColorChance: 0.30, // chance for 'Find en [farve] [ting]'
    running: false, timerId: null, tickId: null,
    set: [], // nuv√¶rende valgmuligheder
    answer: null, // {item:'banana', color:'red'} eller null hvis noMatch
  };

  var el = function(id){ return document.getElementById(id); };
  var board = el('rg-board'), task = el('rg-task'), timebar = el('rg-timebar'), livesEl = el('rg-lives'), startBtn = el('rg-start');

  // ------- DATA -------
  var colors = ['r√∏d','gr√∏n','gul','orange'];
  var items = [
    {key:'apple',    dk:'√¶ble',     base:'red'},
    {key:'banana',   dk:'banan',    base:'yellow'},
    {key:'carrot',   dk:'gulerod',  base:'orange'},
    {key:'broccoli', dk:'broccoli', base:'green'},
    {key:'tomato',   dk:'tomat',    base:'red'}
  ];

  // Map fra dansk farve -> fill
  function colorToFill(c){
    if(c==='r√∏d') return '#ef4444';
    if(c==='gr√∏n') return '#10b981';
    if(c==='gul') return '#f59e0b';
    if(c==='orange') return '#fb923c';
    return '#999';
  }

  // ------- UI -------
  function setLives(n){
    livesEl.innerHTML = '‚ù§Ô∏è'.repeat(n) + 'ü©∂'.repeat(state.maxLives - n);
  }

  function clearTimers(){
    if(state.timerId) { clearTimeout(state.timerId); state.timerId=null; }
    if(state.tickId) { clearInterval(state.tickId); state.tickId=null; }
  }

  function endGame(reason){
    state.running=false;
    clearTimers();
    board.innerHTML='';
    var rank = rankFromScore(state.score);
    var msg = 'Spil slut!<br>Point: <b>'+state.score+'</b><br>Rang: <b>'+rank+'</b>';
    if(reason==='timeout'){ msg = 'Tiden l√∏b ud!<br>'+msg; }
    if(reason==='nolives'){ msg = 'Du l√∏b t√∏r for liv!<br>'+msg; }
    task.innerHTML = msg;
    startBtn.textContent = 'Spil igen';
    startBtn.style.display = 'inline-block';
  }

  function rankFromScore(s){
    if(s<=4) return 'Sneglerefleks';
    if(s<=9) return 'Opvarmet';
    if(s<=14) return 'Reaktionsmester';
    if(s<=19) return 'Lynhurtig';
    return 'Superhjernen';
  }

  function choose(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  // beregn antal felter (flere over tid)
  function slotsForRound(r){
    if(r<3) return 3;
    if(r<6) return 4;
    if(r<9) return 6;
    if(r<12) return 8;
    return 9;
  }

  // Lav en simpel tegnet frugt/gr√∏nt som SVG (med √∏jne og mund)
  function svgFruit(kind, colorName){
    var fill = colorToFill(colorName || 'r√∏d');
    var eye = '<circle cx=\\'18\\' cy=\\'18\\' r=\\'3\\' fill=\\'#111\\'/><circle cx=\\'30\\' cy=\\'18\\' r=\\'3\\' fill=\\'#111\\'/>';
    var mouth = '<path d=\\'M16 28 Q24 34 32 28\\' stroke=\\'#111\\' stroke-width=\\'2\\' fill=\\'none\\'/>';
    var legs = '<rect x=\\'18\\' y=\\'40\\' width=\\'3\\' height=\\'6\\' fill=\\'#333\\'/><rect x=\\'29\\' y=\\'40\\' width=\\'3\\' height=\\'6\\' fill=\\'#333\\'/>';
    var hair = '<rect x=\\'24\\' y=\\'2\\' width=\\'2\\' height=\\'6\\' fill=\\'#333\\'/>';
    var shape='';
    if(kind==='apple' || kind==='tomato'){
      shape = '<circle cx=\\'24\\' cy=\\'24\\' r=\\'18\\' fill=\\''+fill+'\\'/>';
    } else if(kind==='banana'){
      // banan som bue
      shape = '<path d=\\'M8 26 C 12 10, 36 10, 40 26 C 34 22, 16 22, 8 26 Z\\' fill=\\''+fill+'\\'/>';
    } else if(kind==='carrot'){
      shape = '<polygon points=\\'24,6 10,42 38,42\\' fill=\\''+fill+'\\'/>';
    } else if(kind==='broccoli'){
      shape = '<circle cx=\\'18\\' cy=\\'16\\' r=\\'10\\' fill=\\''+fill+'\\'/><circle cx=\\'30\\' cy=\\'18\\' r=\\'10\\' fill=\\''+fill+'\\'/><circle cx=\\'24\\' cy=\\'22\\' r=\\'10\\' fill=\\''+fill+'\\'/>';
    } else if(kind==='heart'){
      // bonusliv
      shape = '<path d=\\'M24 40 L10 26 C4 20, 8 10, 16 12 C20 13, 22 16, 24 18 C26 16, 28 13, 32 12 C40 10, 44 20, 38 26 Z\\' fill=\\'#ef4444\\'/>';
      eye=''; mouth=''; legs=''; hair='';
    }
    var svg = '<svg viewBox=\\'0 0 48 48\\' width=\\'90\\' height=\\'90\\' xmlns=\\'http://www.w3.org/2000/svg\\' aria-hidden=\\'true\\'>'
            + shape + eye + mouth + legs + hair + '</svg>';
    return svg;
  }

  function makeTile(entry){
    var wrapper = document.createElement('button');
    wrapper.setAttribute('type','button');
    wrapper.style.width='110px';
    wrapper.style.height='110px';
    wrapper.style.border='1px solid #ddd';
    wrapper.style.borderRadius='12px';
    wrapper.style.background='#fff';
    wrapper.style.display='flex';
    wrapper.style.alignItems='center';
    wrapper.style.justifyContent='center';
    wrapper.style.cursor='pointer';
    wrapper.style.position='relative';
    wrapper.style.overflow='hidden';
    wrapper.setAttribute('data-kind', entry.kind);
    if(entry.color) wrapper.setAttribute('data-color', entry.color);
    if(entry.bonus) wrapper.setAttribute('data-bonus', '1');

    // evt bev√¶gelse
    if(entry.moving){
      wrapper.style.animation='rgFloat 2.6s ease-in-out infinite';
    }

    wrapper.innerHTML = (entry.bonus ? svgFruit('heart') : svgFruit(entry.kind, entry.color));

    wrapper.setAttribute('onclick',
      \"(function(btn){ if(!window.rgClick) return; rgClick(btn); })(this)\");

    return wrapper;
  }

  // CSS keyframes (injiceres √©n gang)
  (function injectCSS(){
    if(document.getElementById('rg-float-style')) return;
    var st = document.createElement('style');
    st.id='rg-float-style';
    st.textContent = '@keyframes rgFloat{0%{transform:translate(0,0) rotate(0)}25%{transform:translate(6px,-4px) rotate(2deg)}50%{transform:translate(-4px,5px) rotate(-2deg)}75%{transform:translate(5px,3px) rotate(1deg)}100%{transform:translate(0,0) rotate(0)}}';
    document.head.appendChild(st);
  })();

  function updateGridCols(n){
    if(n<=4) board.style.gridTemplateColumns='repeat(2, 1fr)';
    else if(n<=6) board.style.gridTemplateColumns='repeat(3, 1fr)';
    else board.style.gridTemplateColumns='repeat(3, 1fr)';
  }

  // Lav runde
  function buildRound(){
    state.round++;
    board.innerHTML='';
    updateGridCols(slotsForRound(state.round));
    var slots = slotsForRound(state.round);

    // Skal denne runde v√¶re 'no match'?
    var isNoMatch = Math.random() < state.noMatchChance;

    // Skal denne runde v√¶re farve-specifik?
    var isColorTask = !isNoMatch && (Math.random() < state.specialColorChance);

    // V√¶lg m√•l
    var targetItem = choose(items);
    var targetColor = isColorTask ? choose(colors) : null;

    // Task-tekst
    if(isNoMatch){
      task.textContent = 'Find: (Ingen ‚Äì brug knappen ‚ÄúBilledet er der ikke‚Äù)';
      state.answer = null;
    } else if(isColorTask){
      task.textContent = 'Find: '+ targetColor + ' ' + targetItem.dk;
      state.answer = {kind: targetItem.key, color: targetColor};
    } else {
      task.textContent = 'Find: ' + targetItem.dk;
      state.answer = {kind: targetItem.key, color: null};
    }

    // Byg valgmuligheder
    var pool = items.slice();
    // s√∏rg for at vi potentielt kan have farver
    var entries = [];
    // inds√¶t korrekt svar, med en (lille) chance for at droppe det ved isNoMatch
    if(!isNoMatch){
      entries.push({
        kind: targetItem.key,
        color: isColorTask ? targetColor : targetItem.base==='yellow'?'gul': (targetItem.base==='green'?'gr√∏n': (targetItem.base==='orange'?'orange':'r√∏d')),
        moving: Math.random()<state.movingChance
      });
    }

    // fyld resten op med andre ting
    while(entries.length < slots){
      var it = choose(pool);
      var col = choose(colors);
      // undg√• 100% identisk duplikat af svar
      if(state.answer && it.key===state.answer.kind && (!state.answer.color || col===state.answer.color)){
        continue;
      }
      entries.push({
        kind: it.key,
        color: col,
        moving: Math.random()<state.movingChance
      });
    }

    // put eventuelt bonusliv ind (bytter en tilf√¶ldig entry ud)
    if(Math.random() < state.bonusChance){
      var idx = Math.floor(Math.random()*entries.length);
      entries[idx] = { bonus: true, kind:'heart', moving: Math.random()<0.5 };
    }

    // shuffle
    for(var i=entries.length-1;i>0;i--){
      var j=Math.floor(Math.random()*(i+1)); var t=entries[i]; entries[i]=entries[j]; entries[j]=t;
    }

    // render
    entries.forEach(function(ent){
      board.appendChild(makeTile(ent));
    });

    // start timer
    startRoundTimer();
  }

  function startRoundTimer(){
    clearTimers();
    var total = state.timeMs;
    var start = Date.now();
    timebar.style.width = '100%';

    state.tickId = setInterval(function(){
      var elapsed = Date.now()-start;
      var left = Math.max(0, total - elapsed);
      var pct = Math.max(0, Math.floor((left/total)*100));
      timebar.style.width = pct+'%';
    }, 80);

    state.timerId = setTimeout(function(){
      // tid ud
      loseLife('timeout');
    }, total);
  }

  function loseLife(reason){
    clearTimers();
    state.lives--;
    setLives(state.lives);
    if(state.lives<=0){
      endGame('nolives');
      return;
    }
    // ny runde (samme sv√¶rhedsgrad ‚Äì vi s√¶nker ikke tiden for fejl)
    buildRound();
  }

  function correct(){
    clearTimers();
    // +1 point (vi viser ikke nu)
    state.score += 1;
    // g√∏r det lidt sv√¶rere
    state.timeMs = Math.max(state.minTime, state.timeMs - state.stepTime);
    // n√¶ste runde
    buildRound();
  }

  function gainLife(){
    if(state.lives < state.maxLives){
      state.lives += 1;
      setLives(state.lives);
    }
  }

  // ------- PUBLIC handlers (bruges af onclick p√• knapper/tiles) -------
  window.rgStart = function(){
    state.lives=2; state.score=0; state.round=0; state.timeMs=3000;
    setLives(state.lives);
    timebar.style.width='100%';
    startBtn.style.display='none';
    state.running=true;
    buildRound();
  };

  window.rgNoMatch = function(){
    if(!state.running) return;
    if(state.answer===null){
      correct();
    } else {
      loseLife('wrong');
    }
  };

  window.rgClick = function(btn){
    if(!state.running) return;
    if(btn.getAttribute('data-bonus')==='1'){
      // giv liv og fjern bonusknap
      gainLife();
      btn.style.visibility='hidden';
      return; // stadig svar opgaven bagefter
    }
    var kind = btn.getAttribute('data-kind');
    var color = btn.getAttribute('data-color'); // kan v√¶re null
    if(state.answer===null){
      // denne runde har intet korrekt billede ‚Üí klik er forkert
      loseLife('wrong');
      return;
    }
    var needKind = state.answer.kind;
    var needColor = state.answer.color; // kan v√¶re null
    var ok = (kind===needKind) && (needColor ? (color===needColor) : true);
    if(ok) correct(); else loseLife('wrong');
  };

})();">
</div>

</body>
</html>
