<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reaktionsspil ‚Äì Frugt & Gr√∏nt</title>
  <style>
    :root {
      --bg:#f7f7fb; --card:#fff; --text:#111; --muted:#444; --bar:#10b981; --barbg:#e5e7eb;
    }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width:760px; margin:20px auto; padding:16px; }
    .card { background:var(--card); border-radius:14px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:18px; }
    h1 { font-size:1.6rem; margin:0 0 .25rem; text-align:center; }
    .ui { display:flex; gap:10px; align-items:center; justify-content:center; margin:10px 0 14px; flex-wrap:wrap; }
    #lives { font-weight:700; min-width:90px; text-align:left }
    .bar { flex:1 1 280px; height:10px; background:var(--barbg); border-radius:6px; overflow:hidden }
    .bar>div { height:100%; width:100%; background:var(--bar); transition:width .08s linear }
    #task { text-align:center; font-weight:700; font-size:20px; margin:6px 0 12px }
    #board { display:grid; grid-template-columns:repeat(3, minmax(90px,1fr)); gap:10px; justify-items:center; align-items:center; min-height:260px; }
    .tile { width:120px; height:120px; max-width:28vw; max-height:28vw; border:1px solid #ddd; border-radius:12px; background:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative; overflow:hidden }
    .moving { animation:float 2.6s ease-in-out infinite }
    @keyframes float {
      0% {transform:translate(0,0) rotate(0)}
      25%{transform:translate(6px,-4px) rotate(2deg)}
      50%{transform:translate(-4px,5px) rotate(-2deg)}
      75%{transform:translate(5px,3px) rotate(1deg)}
      100%{transform:translate(0,0) rotate(0)}
    }
    .cta { text-align:center; margin-top:10px }
    button { padding:10px 16px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer }
    #skip { border:1px solid #ddd; background:#fff; color:#111 }
    .muted { color:var(--muted); font-size:.95rem }
    .center { text-align:center }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Reaktionsspil: Frugt &amp; Gr√∏nt üçéü•ï</h1>

      <div class="ui">
        <div id="lives">‚ù§Ô∏è‚ù§Ô∏è</div>
        <div class="bar"><div id="timebar"></div></div>
        <button id="skip" title="Brug hvis det rigtige billede slet ikke findes">Billedet er der ikke</button>
      </div>

      <div id="task">Klik ‚ÄúStart‚Äù for at spille</div>

      <div id="board" aria-live="polite"></div>

      <div class="cta">
        <button id="start">Start</button>
      </div>

      <p class="muted center" style="margin-top:14px">
        Tip: Bonusliv (‚ù§Ô∏è) kan altid samles. Paran√∏d (ü•ú) giver +5 point, men er aldrig selve opgaven.
      </p>
    </div>
  </div>

  <script>
    // ---------- Konfiguration ----------
    const COLORS_DK = ['r√∏d','gr√∏n','gul','orange'];
    const ITEMS = [
      {key:'apple',    dk:'√¶ble',     base:'r√∏d'},
      {key:'banana',   dk:'banan',    base:'gul'},
      {key:'carrot',   dk:'gulerod',  base:'orange'},
      {key:'broccoli', dk:'broccoli', base:'gr√∏n'},
      {key:'tomato',   dk:'tomat',    base:'r√∏d'}
    ];

    const STATE = {
      lives: 2, maxLives: 3,
      score: 0, bonusBrazil: 0,
      round: 0,
      timeMs: 3000, minTime: 1100, stepTime: 120,
      movingChance: 0.35,
      bonusLifeChance: 0.22,
      noMatchChance: 0.18,
      colorTaskChance: 0.30,
      brazilNutChance: 0.05, // meget sj√¶ldent
      running: false,
      answer: null, // null = no-match-runde, ellers {kind,color?}
      timerId: null, tickId: null
    };

    // ---------- Hj√¶lpere ----------
    const $ = sel => document.querySelector(sel);
    const elBoard = $('#board'), elTask = $('#task'), elTime = $('#timebar'), elLives = $('#lives');
    const elStart = $('#start'), elSkip = $('#skip');

    const choose = arr => arr[Math.floor(Math.random()*arr.length)];

    function setLives(n){
      elLives.textContent = '‚ù§Ô∏è'.repeat(n) + 'ü©∂'.repeat(STATE.maxLives-n);
    }

    function colorFill(dk){
      switch(dk){
        case 'r√∏d': return '#ef4444';
        case 'gr√∏n': return '#10b981';
        case 'gul': return '#f59e0b';
        case 'orange': return '#fb923c';
        default: return '#999';
      }
    }

    // ---------- SVG "grafik" (med √∏jne, mund, evt. ben/h√•r) ----------
    function svgFruit(kind, colorName){
      const fill = colorFill(colorName || 'r√∏d');
      let eye = `<circle cx="18" cy="18" r="3" fill="#111"/><circle cx="30" cy="18" r="3" fill="#111"/>`;
      let mouth = `<path d="M16 28 Q24 34 32 28" stroke="#111" stroke-width="2" fill="none"/>`;
      let legs = `<rect x="18" y="40" width="3" height="6" fill="#333"/><rect x="29" y="40" width="3" height="6" fill="#333"/>`;
      let hair = `<rect x="24" y="2" width="2" height="6" fill="#333"/>`;
      let shape = '';

      if(kind==='apple' || kind==='tomato'){
        shape = `<circle cx="24" cy="24" r="18" fill="${fill}"/>`;
      } else if(kind==='banana'){
        shape = `<path d="M8 26 C 12 10, 36 10, 40 26 C 34 22, 16 22, 8 26 Z" fill="${fill}"/>`;
      } else if(kind==='carrot'){
        shape = `<polygon points="24,6 10,42 38,42" fill="${fill}"/>`;
      } else if(kind==='broccoli'){
        shape = `<circle cx="18" cy="16" r="10" fill="${fill}"/><circle cx="30" cy="18" r="10" fill="${fill}"/><circle cx="24" cy="22" r="10" fill="${fill}"/>`;
      } else if(kind==='heart'){ // bonusliv
        shape = `<path d="M24 40 L10 26 C4 20, 8 10, 16 12 C20 13, 22 16, 24 18 C26 16, 28 13, 32 12 C40 10, 44 20, 38 26 Z" fill="#ef4444"/>`;
        eye = mouth = legs = hair = '';
      } else if(kind==='brazilnut'){ // paran√∏d (bonus +5)
        shape = `<path d="M10 30 C10 16, 22 8, 34 14 C42 18, 42 30, 32 36 C24 40, 14 38, 10 30 Z" fill="#8b5e3c"/>
                 <path d="M14 26 C18 18, 30 16, 34 22 C28 18, 20 20, 14 26 Z" fill="#a87954"/>`;
        // lille ansigt for sjov
        eye = `<circle cx="20" cy="24" r="2.5" fill="#111"/><circle cx="28" cy="24" r="2.5" fill="#111"/>`;
        mouth = `<path d="M20 28 Q24 31 28 28" stroke="#111" stroke-width="1.8" fill="none"/>`;
        legs = hair = '';
      }
      return `<svg viewBox="0 0 48 48" width="90" height="90" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">${shape}${eye}${mouth}${legs}${hair}</svg>`;
    }

    // ---------- Br√¶t ----------
    function slotsForRound(r){
      if(r<3) return 3;
      if(r<6) return 4;
      if(r<9) return 6;
      if(r<12) return 8;
      return 9;
    }
    function updateGridCols(n){
      if(n<=4) elBoard.style.gridTemplateColumns = 'repeat(2, minmax(90px,1fr))';
      else elBoard.style.gridTemplateColumns = 'repeat(3, minmax(90px,1fr))';
    }

    function clearTimers(){
      if(STATE.timerId){ clearTimeout(STATE.timerId); STATE.timerId=null; }
      if(STATE.tickId){ clearInterval(STATE.tickId); STATE.tickId=null; }
    }

    function endGame(reason){
      STATE.running=false;
      clearTimers();
      elBoard.innerHTML='';
      const rank = (s=>{
        if(s<=4) return 'Sneglerefleks';
        if(s<=9) return 'Opvarmet';
        if(s<=14) return 'Reaktionsmester';
        if(s<=19) return 'Lynhurtig';
        return 'Superhjernen';
      })(STATE.score);
      let msg = `Spil slut!<br>Point: <b>${STATE.score}</b> (Paran√∏d bonus: +${STATE.bonusBrazil*5})<br>Rang: <b>${rank}</b>`;
      if(reason==='timeout') msg = '‚è≥ Tiden l√∏b ud!<br>' + msg;
      if(reason==='nolives') msg = 'üíî Du l√∏b t√∏r for liv!<br>' + msg;
      elTask.innerHTML = msg;
      elStart.textContent = 'Spil igen';
      elStart.style.display = 'inline-block';
    }

    function startRoundTimer(){
      clearTimers();
      const total = STATE.timeMs;
      const start = Date.now();
      elTime.style.width = '100%';

      STATE.tickId = setInterval(()=>{
        const left = Math.max(0, total - (Date.now()-start));
        const pct = Math.max(0, Math.floor((left/total)*100));
        elTime.style.width = pct + '%';
      }, 80);

      STATE.timerId = setTimeout(()=> loseLife('timeout'), total);
    }

    function loseLife(){
      clearTimers();
      STATE.lives--;
      setLives(STATE.lives);
      if(STATE.lives<=0){ endGame('nolives'); return; }
      buildRound(); // pr√∏v igen med ny runde
    }

    function correct(){
      clearTimers();
      STATE.score += 1;             // 1 point per runde
      STATE.timeMs = Math.max(STATE.minTime, STATE.timeMs - STATE.stepTime); // sv√¶rere
      buildRound();
    }

    function gainLife(){
      if(STATE.lives < STATE.maxLives){
        STATE.lives += 1; setLives(STATE.lives);
      }
    }

    function addBrazilBonus(){
      STATE.score += 5;  // bonus
      STATE.bonusBrazil += 1;
    }

    // ---------- Rundeopbygning ----------
    function buildRound(){
      STATE.round++;
      elBoard.innerHTML = '';
      const slots = slotsForRound(STATE.round);
      updateGridCols(slots);

      // V√¶lg rundetype
      const isNoMatch = Math.random() < STATE.noMatchChance;
      const isColorTask = !isNoMatch && (Math.random() < STATE.colorTaskChance);

      const targetItem = choose(ITEMS);
      const targetColor = isColorTask ? choose(COLORS_DK) : null;

      if(isNoMatch){
        elTask.textContent = 'Find: (Ingen ‚Äì brug knappen ‚ÄúBilledet er der ikke‚Äù)';
        STATE.answer = null; // ingen korrekt flise i denne runde
      } else if(isColorTask){
        elTask.textContent = `Find: ${targetColor} ${targetItem.dk}`;
        STATE.answer = {kind: targetItem.key, color: targetColor};
      } else {
        elTask.textContent = `Find: ${targetItem.dk}`;
        STATE.answer = {kind: targetItem.key, color: null};
      }

      // Lav entries
      const entries = [];

      // korrekt svar (med farve hvis relevant)
      if(!isNoMatch){
        entries.push({
          kind: targetItem.key,
          color: isColorTask ? targetColor : targetItem.base,
          moving: Math.random() < STATE.movingChance
        });
      }

      // √∏vrige tilf√¶ldige
      while(entries.length < slots){
        const it = choose(ITEMS);
        const col = choose(COLORS_DK);
        // undg√• identisk kopi af svaret
        if(STATE.answer && it.key===STATE.answer.kind && (!STATE.answer.color || col===STATE.answer.color)) continue;
        entries.push({
          kind: it.key,
          color: col,
          moving: Math.random() < STATE.movingChance
        });
      }

      // bonusliv? (erstatter en tilf√¶ldig entry)
      if(Math.random() < STATE.bonusLifeChance){
        const idx = Math.floor(Math.random()*entries.length);
        entries[idx] = { kind:'heart', bonus:true, moving: Math.random()<0.5 };
      }

      // paran√∏d? (erstatter en anden tilf√¶ldig entry; er ALDRIG m√•l)
      if(Math.random() < STATE.brazilNutChance){
        // find en plads der ikke allerede er bonus
        let idx = Math.floor(Math.random()*entries.length);
        if(entries[idx].bonus) idx = (idx+1) % entries.length;
        entries[idx] = { kind:'brazilnut', brazil:true, moving: Math.random()<0.35 };
      }

      // shuffle
      for(let i=entries.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [entries[i], entries[j]] = [entries[j], entries[i]];
      }

      // render
      for(const ent of entries){
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'tile' + (ent.moving ? ' moving' : '');
        btn.dataset.kind = ent.kind;
        if(ent.color) btn.dataset.color = ent.color;
        if(ent.bonus) btn.dataset.bonus = '1';
        if(ent.brazil) btn.dataset.brazil = '1';
        btn.innerHTML = ent.bonus ? svgFruit('heart')
                   : ent.brazil ? svgFruit('brazilnut')
                   : svgFruit(ent.kind, ent.color);
        btn.addEventListener('click', onTileClick);
        elBoard.appendChild(btn);
      }

      startRoundTimer();
    }

    function onTileClick(e){
      if(!STATE.running) return;
      const btn = e.currentTarget;
      if(btn.dataset.bonus==='1'){        // ‚ù§Ô∏è bonusliv
        gainLife();
        btn.style.visibility='hidden';
        return;                           // stadig svar opgaven bagefter
      }
      if(btn.dataset.brazil==='1'){       // ü•ú paran√∏d ‚Üí +5 point
        addBrazilBonus();
        btn.style.visibility='hidden';
        return;
      }

      // almindelig klik ‚Üí vurder mod opgaven
      if(STATE.answer===null){
        // denne runde skal man trykke p√• "Billedet er der ikke"
        loseLife('wrong'); return;
      }
      const needKind = STATE.answer.kind;
      const needColor = STATE.answer.color; // kan v√¶re null
      const k = btn.dataset.kind;
      const c = btn.dataset.color || null;

      const ok = (k===needKind) && (needColor ? (c===needColor) : true);
      if(ok) correct(); else loseLife('wrong');
    }

    // ---------- Public knapper ----------
    elStart.addEventListener('click', ()=>{
      STATE.lives = 2; STATE.score = 0; STATE.bonusBrazil = 0;
      STATE.round = 0; STATE.timeMs = 3000; STATE.running = true;
      setLives(STATE.lives);
      elTime.style.width = '100%';
      elStart.style.display = 'none';
      buildRound();
    });

    elSkip.addEventListener('click', ()=>{
      if(!STATE.running) return;
      if(STATE.answer===null) correct(); else loseLife('wrong');
    });
  </script>
</body>
</html>
