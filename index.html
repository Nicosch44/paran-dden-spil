<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reaktionsspil ‚Äì Frugt & Gr√∏nt</title>
  <style>
    :root { --bg:#f7f7fb; --card:#fff; --text:#111; --muted:#444; --bar:#10b981; --barbg:#e5e7eb; }
    body { margin:0; font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width:760px; margin:20px auto; padding:16px; }
    .card { background:var(--card); border-radius:14px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:18px; }
    h1 { font-size:1.6rem; margin:0 0 .25rem; text-align:center; }
    .ui { display:flex; gap:10px; align-items:center; justify-content:center; margin:10px 0 14px; flex-wrap:wrap; }
    #lives { font-weight:700; min-width:90px; text-align:left }
    .bar { flex:1 1 280px; height:10px; background:var(--barbg); border-radius:6px; overflow:hidden }
    .bar>div { height:100%; width:100%; background:var(--bar); transition:width .08s linear }
    #task { text-align:center; font-weight:700; font-size:20px; margin:6px 0 12px }
    #board { display:grid; grid-template-columns:repeat(3, minmax(90px,1fr)); gap:12px; justify-items:center; align-items:center; min-height:260px; }
    .tile { width:140px; height:140px; max-width:30vw; max-height:30vw; border:1px solid #ddd; border-radius:14px; background:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative; overflow:hidden }
    .tile img { width:100%; height:100%; object-fit:cover; display:block; }
    .face { position:absolute; inset:0; pointer-events:none; display:flex; align-items:center; justify-content:center; }
    .moving { animation:float 2.6s ease-in-out infinite }
    @keyframes float {
      0% {transform:translate(0,0) rotate(0)}
      25%{transform:translate(6px,-4px) rotate(2deg)}
      50%{transform:translate(-4px,5px) rotate(-2deg)}
      75%{transform:translate(5px,3px) rotate(1deg)}
      100%{transform:translate(0,0) rotate(0)}
    }
    .cta { text-align:center; margin-top:10px }
    button.main { padding:10px 16px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer }
    .muted { color:var(--muted); font-size:.95rem; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Reaktionsspil: Frugt &amp; Gr√∏nt üçéü•ï</h1>

      <div class="ui">
        <div id="lives">‚ù§Ô∏è‚ù§Ô∏è</div>
        <div class="bar"><div id="timebar"></div></div>
      </div>

      <div id="task">Klik ‚ÄúStart‚Äù for at spille</div>

      <div id="board" aria-live="polite"></div>

      <div class="cta">
        <button id="start" class="main">Start</button>
      </div>

      <p class="muted" style="margin-top:14px">
        Tip: ‚ù§Ô∏è kan altid samles (max 3 liv). ü•ú (paran√∏d) giver +5 point og er aldrig m√•let.
      </p>
    </div>
  </div>

  <script>
    /* ==============================
       üîß KONFIG ‚Äì √Ündr tempo her
       ============================== */
    const CONFIG = {
      TIME_CURVE_MS: [9000, 8500, 8000, 7600, 7200, 6800, 6500, 6200, 6000, 5800, 5600, 5400, 5200, 5000],
      MOVING_CHANCE: 0.30,      // chance for at en flise bev√¶ger sig
      BONUS_LIFE_CHANCE: 0.22,  // chance for at ‚ù§Ô∏è dukker op
      BRAZIL_NUT_CHANCE: 0.05,  // chance for paran√∏d (ü•ú), giver +5 point
      MAX_LIVES: 3,
      START_LIVES: 2
    };

    // ==============================
    // Data & helpers
    // ==============================
    const ITEMS = [
      {key:'apple',    dk:'√¶ble',     src:'img/apple.jpg'},
      {key:'banana',   dk:'banan',    src:'img/banana.jpg'},
      {key:'carrot',   dk:'gulerod',  src:'img/carrot.jpg'},
      {key:'broccoli', dk:'broccoli', src:'img/broccoli.jpg'},
      {key:'tomato',   dk:'tomat',    src:'img/tomato.jpg'}
    ];

    const $ = s => document.querySelector(s);
    const elBoard = $('#board'), elTask = $('#task'), elTime = $('#timebar'), elLives = $('#lives');
    const elStart = $('#start');

    const STATE = {
      lives: CONFIG.START_LIVES, maxLives: CONFIG.MAX_LIVES,
      score: 0, bonusBrazil: 0,
      round: 0, running: false,
      answer: null, // {kind}
      timerId: null, tickId: null
    };

    const choose = arr => arr[Math.floor(Math.random()*arr.length)];
    const timeForRound = r => CONFIG.TIME_CURVE_MS[Math.min(r-1, CONFIG.TIME_CURVE_MS.length-1)];
    function setLives(n){ elLives.textContent = '‚ù§Ô∏è'.repeat(n) + 'ü©∂'.repeat(CONFIG.MAX_LIVES-n); }

    // simple ‚Äú√∏jne+mund‚Äù SVG overlay
    const FACE = `
      <svg viewBox="0 0 48 48" width="72" height="72" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <circle cx="18" cy="18" r="4" fill="#111"/>
        <circle cx="30" cy="18" r="4" fill="#111"/>
        <path d="M16 30 Q24 36 32 30" stroke="#111" stroke-width="3" fill="none" stroke-linecap="round"/>
      </svg>`;

    // bonus-hjerte og paran√∏d
    const SVG_HEART = `
      <svg viewBox="0 0 48 48" width="90" height="90" xmlns="http://www.w3.org/2000/svg">
        <path d="M24 40 L10 26 C4 20, 8 10, 16 12 C20 13, 22 16, 24 18 C26 16, 28 13, 32 12 C40 10, 44 20, 38 26 Z"
              fill="#ef4444"/>
      </svg>`;
    const SVG_BRAZIL = `
      <svg viewBox="0 0 48 48" width="90" height="90" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 30 C10 16, 22 8, 34 14 C42 18, 42 30, 32 36 C24 40, 14 38, 10 30 Z" fill="#8b5e3c"/>
        <path d="M14 26 C18 18, 30 16, 34 22 C28 18, 20 20, 14 26 Z" fill="#a87954"/>
        <circle cx="20" cy="24" r="3" fill="#111"/><circle cx="28" cy="24" r="3" fill="#111"/>
        <path d="M20 28 Q24 31 28 28" stroke="#111" stroke-width="2" fill="none"/>
      </svg>`;

    function clearTimers(){ if(STATE.timerId){clearTimeout(STATE.timerId);STATE.timerId=null;} if(STATE.tickId){clearInterval(STATE.tickId);STATE.tickId=null;} }
    function endGame(reason){
      STATE.running=false; clearTimers(); elBoard.innerHTML='';
      const rank = (s=>{ if(s<=4)return'Sneglerefleks'; if(s<=9)return'Opvarmet'; if(s<=14)return'Reaktionsmester'; if(s<=19)return'Lynhurtig'; return'Superhjernen'; })(STATE.score);
      let msg = `Spil slut!<br>Point: <b>${STATE.score}</b> (Paran√∏d bonus: +${STATE.bonusBrazil*5})<br>Rang: <b>${rank}</b>`;
      if(reason==='timeout') msg = '‚è≥ Tiden l√∏b ud!<br>'+msg;
      if(reason==='nolives') msg = 'üíî Du l√∏b t√∏r for liv!<br>'+msg;
      elTask.innerHTML = msg;
      elStart.textContent = 'Spil igen';
      elStart.style.display = 'inline-block';
    }

    function startRoundTimer(){
      clearTimers();
      const total = timeForRound(STATE.round);
      const start = Date.now();
      elTime.style.width = '100%';

      STATE.tickId = setInterval(()=>{
        const left = Math.max(0, total - (Date.now()-start));
        elTime.style.width = Math.max(0, Math.floor((left/total)*100)) + '%';
      }, 80);

      STATE.timerId = setTimeout(()=> loseLife('timeout'), total);
    }

    function loseLife(){ clearTimers(); STATE.lives--; setLives(STATE.lives); if(STATE.lives<=0){ endGame('nolives'); return; } buildRound(); }
    function correct(){ clearTimers(); STATE.score += 1; buildRound(); }
    function gainLife(){ if(STATE.lives<CONFIG.MAX_LIVES){ STATE.lives++; setLives(STATE.lives); } }
    function addBrazilBonus(){ STATE.score += 5; STATE.bonusBrazil++; }

    function slotsForRound(r){ if(r<3) return 3; if(r<6) return 4; if(r<9) return 6; if(r<12) return 8; return 9; }
    function updateGridCols(n){ elBoard.style.gridTemplateColumns = (n<=4)?'repeat(2, minmax(90px,1fr))':'repeat(3, minmax(90px,1fr))'; }

    function buildRound(){
      STATE.round++; elBoard.innerHTML='';
      const slots = slotsForRound(STATE.round);
      updateGridCols(slots);

      // V√¶lg m√•l ‚Äì og s√∏rg for at m√•let ALTID er med
      const target = choose(ITEMS);
      STATE.answer = {kind: target.key};
      elTask.textContent = `Find: ${target.dk}`;

      const entries = [];

      // Tilf√∏j korrekt billede f√∏rst
      entries.push({ kind: target.key, src: target.src, moving: Math.random()<CONFIG.MOVING_CHANCE });

      // Fyld op med andre billeder
      while(entries.length < slots){
        const it = choose(ITEMS);
        if(it.key === target.key) continue; // undg√• flere identiske m√•l
        entries.push({ kind: it.key, src: it.src, moving: Math.random()<CONFIG.MOVING_CHANCE });
      }

      // Bonusliv?
      if(Math.random() < CONFIG.BONUS_LIFE_CHANCE){
        const i = Math.floor(Math.random()*entries.length);
        entries[i] = { bonus:true, kind:'heart', moving: Math.random()<0.5 };
      }
      // Paran√∏d?
      if(Math.random() < CONFIG.BRAZIL_NUT_CHANCE){
        let j = Math.floor(Math.random()*entries.length);
        if(entries[j].bonus) j = (j+1)%entries.length;
        entries[j] = { brazil:true, kind:'brazilnut', moving: Math.random()<0.35 };
      }

      // Shuffle
      for(let i=entries.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [entries[i],entries[j]]=[entries[j],entries[i]]; }

      // Render
      for(const ent of entries){
        const btn = document.createElement('button');
        btn.type='button';
        btn.className = 'tile' + (ent.moving ? ' moving' : '');

        if(ent.bonus){
          btn.innerHTML = SVG_HEART;
          btn.addEventListener('click', ()=>{ if(!STATE.running) return; gainLife(); btn.style.visibility='hidden'; });
        } else if(ent.brazil){
          btn.innerHTML = SVG_BRAZIL;
          btn.addEventListener('click', ()=>{ if(!STATE.running) return; addBrazilBonus(); btn.style.visibility='hidden'; });
        } else {
          const img = document.createElement('img');
          img.src = ent.src; img.alt = ent.kind;
          const face = document.createElement('div'); face.className='face'; face.innerHTML = FACE;
          btn.dataset.kind = ent.kind;
          btn.appendChild(img); btn.appendChild(face);
          btn.addEventListener('click', ()=>{
            if(!STATE.running) return;
            const ok = (btn.dataset.kind === STATE.answer.kind);
            ok ? correct() : loseLife('wrong');
          });
        }
        elBoard.appendChild(btn);
      }

      startRoundTimer();
    }

    // Start/Restart
    $('#start').addEventListener('click', ()=>{
      STATE.lives = CONFIG.START_LIVES; STATE.score=0; STATE.bonusBrazil=0; STATE.round=0; STATE.running=true;
      setLives(STATE.lives); elTime.style.width='100%'; $('#start').style.display='none'; buildRound();
    });
  </script>
</body>
</html>
